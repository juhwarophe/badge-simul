<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë±ƒì§€ ì‹œë®¬ë ˆì´í„°</title>
<style>
  body { font-family: Pretendard, sans-serif; background:#121212; color:#eee; text-align:center; padding:20px; margin:0; }
  h1 { color:#ffcc00; margin-top:12px; }
  .option { margin:8px auto; width:60%; padding:10px; border-radius:10px; cursor:pointer; transition:0.2s; color:#000; }
  .option:hover { filter: brightness(1.1); }
  .locked { border:2px solid #fff; }
  .btn { padding:10px 20px; background:#ffcc00; border:none; border-radius:10px; cursor:pointer; font-weight:bold; margin-top:20px; }
  .btn:hover { background:#ffdd33; }
  label { display:block; margin:20px; }

  /* ë©”ì¸ í™”ë©´ */
  #mainScreen, #underConstruction {
    display:flex; justify-content:center; align-items:center; gap:20px; height:calc(100vh - 40px);
  }
  .mainImage { width:150px; height:150px; border-radius:20px; cursor:pointer; display:flex; justify-content:center; align-items:center; overflow:hidden; transition:0.2s; background:#333; }
  .mainImage:hover { filter: brightness(1.2); }
  .mainImage img { width:100%; height:100%; object-fit:cover; display:block; }

  #simulatorScreen { display:none; padding:24px; min-height: calc(100vh - 40px); box-sizing:border-box; }
  #underConstruction { display:none; flex-direction:column; color:#ffcc00; font-size:24px; }
  .smallBtn { margin-top:16px; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; background:#444; color:#fff; }

  /* ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜ í‘œì‹œ */
  #rollCountDisplay { margin-top:10px; font-size:18px; color:#aaa; }
  #resetBtn { margin-left:8px; padding:6px 12px; font-size:14px; border-radius:6px; background:#333; color:#ffcc00; border:1px solid #ffcc00; cursor:pointer; }
  #resetBtn:hover { background:#444; }
</style>
</head>
<body>

<!-- ë©”ì¸ í™”ë©´ -->
<div id="mainScreen">
  <div class="mainImage" id="leftImage" title="ì‹œë®¬ë ˆì´í„°ë¡œ ì´ë™">
    <img src="https://i.ifh.cc/NotKyl.png" alt="ì™¼ìª½ ì´ë¯¸ì§€">
  </div>
  <div class="mainImage" id="midImage" title="ì¤€ë¹„ì¤‘">
    <img src="https://i.ifh.cc/HgXLM7.png" alt="ê°€ìš´ë° ì´ë¯¸ì§€">
  </div>
  <div class="mainImage" id="rightImage" title="ì¤€ë¹„ì¤‘">
    <div style="color:#ddd; font-size:14px;">(ì¤€ë¹„ì¤‘)</div>
  </div>
</div>

<!-- ì¤€ë¹„ì¤‘ í™”ë©´ -->
<div id="underConstruction">
  <div>ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤</div>
  <button class="smallBtn" onclick="backToMain()">ë©”ì¸ìœ¼ë¡œ</button>
</div>

<!-- ë±ƒì§€ ì‹œë®¬ë ˆì´í„° í™”ë©´ -->
<div id="simulatorScreen">
  <h1>ë±ƒì§€ ì‹œë®¬ë ˆì´í„°</h1>
  <div id="rollCountDisplay">
    ğŸ² ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜: <span id="rollCount">0</span>íšŒ
    <button id="resetBtn" onclick="resetSimulation()">ë¦¬ì…‹</button>
  </div>
  <label>
    <input type="checkbox" id="useRefine"> ì—°ë§ˆì œ ì‚¬ìš© (ìµœëŒ€ 2ê°œ ì˜µì…˜ ì ê¸ˆ ê°€ëŠ¥)
  </label>
  <button class="btn" onclick="rollOptions()">ì˜µì…˜ êµ´ë¦¬ê¸°</button>
  <div id="options"></div>
  <button class="btn" onclick="backToMain()">ë©”ì¸ í™”ë©´ìœ¼ë¡œ</button>
</div>

<script>
function showSimulator(){
  document.getElementById("mainScreen").style.display = "none";
  document.getElementById("underConstruction").style.display = "none";
  document.getElementById("simulatorScreen").style.display = "block";
}
function showUnderConstruction(){
  document.getElementById("mainScreen").style.display = "none";
  document.getElementById("simulatorScreen").style.display = "none";
  document.getElementById("underConstruction").style.display = "flex";
}
function backToMain(){
  document.getElementById("simulatorScreen").style.display = "none";
  document.getElementById("underConstruction").style.display = "none";
  document.getElementById("mainScreen").style.display = "flex";
}
document.getElementById("leftImage").addEventListener("click", showSimulator);
document.getElementById("midImage").addEventListener("click", showUnderConstruction);
document.getElementById("rightImage").addEventListener("click", ()=>alert("ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤."));

const groups = [
  {
    weight:30,
    options:[
      ["ì²´ë ¥",[680,850,1020]],
      ["ê³µê²©ë ¥",[70,88,105]],
      ["ë°©ì–´ë ¥",[35,44,53]],
      ["ì²´ë ¥",["4%","5%","6%","12%"]],
      ["ê³µê²©ë ¥",["4%","5%","6%","12%"]],
      ["ë°©ì–´ë ¥",["10%","12.5%","15%"]],
    ]
  },
  {
    weight:27.65,
    options:[
      ["ì¼ë°˜ ê³µê²© ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%"]],
      ["ìŠ¤í‚¬ ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%"]],
      ["í•„ì‚´ê¸° ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%"]],
      ["í‘œì‹ ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%"]],
      ["ì†Œí™˜ë¬¼ ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%"]],
      ["íŒŒìƒë¬¼ ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%"]],
    ]
  },
  {
    weight:34.35,
    options:[
      ["ì¹˜ëª…íƒ€ í”¼í•´",["8%","10%","12%"]],
      ["ì†ì„± í”¼í•´",["4%","5%","6%","12%"]],
      ["ì¼ë°˜ê³µê²© í”¼í•´",["10%","12.5%","15%","30%"]],
      ["ìŠ¤í‚¬ í”¼í•´",["7%","8%","10%","20%"]],
      ["í•„ì‚´ê¸° í”¼í•´",["10%","13%","15%","30%"]],
      ["í‘œì‹ í”¼í•´",["27%","33%","40%","80%"]],
      ["ì†Œí™˜ë¬¼ í”¼í•´",["7%","8%","10%","20%"]],
      ["íŒŒìƒë¬¼ í”¼í•´",["7%","8%","10%","20%"]],
    ]
  },
  {
    weight:8,
    options:[
      ["ì¹˜ëª…íƒ€ìœ¨",["5%","6.3%","7.5%","15%"]],
      ["ì†ì„± ê´€í†µ",[35,40,53,110]],
      ["ë©”ì¸ SP",["10%","12.5%","15%","30%"]],
      ["ì§€ì› SP",["13.5","17","20.3","40%"]],
    ]
  }
];

const tierWeights = [40,35,15,10];
const colors = ["#66ff66","#33ccff","#ffdd33"];
const lockedOptions = new Set();
const optionsDiv = document.getElementById("options");
const useRefine = document.getElementById("useRefine");
let optionValues = [];

// ğŸ² ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜ ë³€ìˆ˜
let rollCount = 0;
const rollCountSpan = document.getElementById("rollCount");

function randomByWeight(weights){
  const total = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*total;
  for(let i=0;i<weights.length;i++){
    if(r<weights[i]) return i;
    r-=weights[i];
  }
  return weights.length-1;
}

function pickGroup(){
  const weights = groups.map(g=>g.weight);
  const total = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*total;
  for(let i=0;i<weights.length;i++){
    if(r<weights[i]) return groups[i];
    r -= weights[i];
  }
  return groups[groups.length-1];
}

function pickUniqueOptions(excludeNames){
  const result = [];
  const usedNames = new Set(excludeNames);

  while(result.length < 4 - excludeNames.length){
    const group = pickGroup();
    const candidates = group.options.filter(o => !usedNames.has(o[0]));
    if(candidates.length === 0) continue;
    const opt = candidates[Math.floor(Math.random()*candidates.length)];

    let tierIndex = randomByWeight(tierWeights);
    if(tierIndex >= opt[1].length) tierIndex = opt[1].length - 1;
    const val = opt[1][tierIndex];

    result.push({ name: opt[0], value: val, tier: tierIndex, maxTier: opt[1].length - 1 });
    usedNames.add(opt[0]);
  }
  return result;
}

function rollOptions(){
  const lockedNames = [];
  for(let i=0;i<4;i++){
    if(lockedOptions.has(i)) lockedNames.push(optionValues[i].name);
  }

  const newValues = pickUniqueOptions(lockedNames);
  let ni=0;
  for(let i=0;i<4;i++){
    if(lockedOptions.has(i)) continue;
    optionValues[i]=newValues[ni++];
  }

  // ğŸ² ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜ +1
  rollCount++;
  rollCountSpan.textContent = rollCount;

  renderOptions();
}

function resetSimulation(){
  if(!confirm("ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
  rollCount = 0;
  rollCountSpan.textContent = rollCount;
  lockedOptions.clear();
  optionValues = pickUniqueOptions([]);
  renderOptions();
}

function toggleLock(i){
  if(!useRefine.checked) return;
  if(lockedOptions.has(i)){
    lockedOptions.delete(i);
  } else {
    if(lockedOptions.size>=2){ alert("ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ì ê¸€ ìˆ˜ ìˆìŠµë‹ˆë‹¤!"); return; }
    lockedOptions.add(i);
  }
  renderOptions();
}

function renderOptions(){
  optionsDiv.innerHTML="";
  for(let i=0;i<4;i++){
    const opt = optionValues[i];
    const div=document.createElement("div");
    div.textContent=`${opt.name} +${opt.value}`;
    div.className="option";
    if(lockedOptions.has(i)) div.classList.add("locked");

    if(opt.tier === 3 && opt.maxTier >= 3){
      div.style.background = "linear-gradient(90deg, #ff9a9e, #fad0c4, #fbc2eb, #a1c4fd, #c2e9fb)";
      div.style.color = "#fff";
      div.style.textShadow = "0 0 3px #000";
      div.style.fontWeight = "bold";
    } else {
      const colorIndex = Math.min(opt.tier, 2);
      div.style.background = colors[colorIndex];
      div.style.color = "#000";
    }

    div.onclick = ()=>toggleLock(i);
    optionsDiv.appendChild(div);
  }
}

optionValues = pickUniqueOptions([]);
while(optionValues.length<4){
  const existingNames = optionValues.map(v=>v.name);
  const extra = pickUniqueOptions(existingNames)[0];
  optionValues.push(extra);
}
renderOptions();
</script>
</body>
</html>
