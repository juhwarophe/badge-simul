<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>뱃지 시뮬레이터</title>
<style>
  body { font-family: Pretendard, sans-serif; background:#121212; color:#eee; text-align:center; padding:20px; margin:0; }
  h1 { color:#ffcc00; margin-top:12px; }
  .option { margin:8px auto; width:60%; padding:10px; border-radius:10px; cursor:pointer; transition:0.2s; color:#000; }
  .option:hover { filter: brightness(1.1); }
  .locked { border:2px solid #fff; }
  .btn { padding:10px 20px; background:#ffcc00; border:none; border-radius:10px; cursor:pointer; font-weight:bold; margin-top:20px; }
  .btn:hover { background:#ffdd33; }
  label { display:block; margin:20px; }

  /* 메인 화면 */
  #mainScreen, #underConstruction {
    display:flex; justify-content:center; align-items:center; gap:20px; height:calc(100vh - 40px);
  }
  .mainImage { width:150px; height:150px; border-radius:20px; cursor:pointer; display:flex; justify-content:center; align-items:center; overflow:hidden; transition:0.2s; background:#333; }
  .mainImage:hover { filter: brightness(1.2); }
  .mainImage img { width:100%; height:100%; object-fit:cover; display:block; }

  #simulatorScreen { display:none; padding:24px; min-height: calc(100vh - 40px); box-sizing:border-box; }
  #underConstruction { display:none; flex-direction:column; color:#ffcc00; font-size:24px; }
  .smallBtn { margin-top:16px; padding:8px 14px; border-radius:8px; border:none; cursor:pointer; background:#444; color:#fff; }
</style>
</head>
<body>

<!-- 메인 화면 -->
<div id="mainScreen">
  <div class="mainImage" id="leftImage" title="시뮬레이터로 이동">
    <img src="https://i.ifh.cc/NotKyl.png" alt="왼쪽 이미지">
  </div>
  <div class="mainImage" id="midImage" title="공사중">
    <img src="https://i.ifh.cc/HgXLM7.png" alt="가운데 이미지">
  </div>
  <div class="mainImage" id="rightImage" title="준비중">
    <div style="color:#ddd; font-size:14px;">(준비중)</div>
  </div>
</div>

<!-- 공사중 화면 -->
<div id="underConstruction">
  <div>공사중입니다</div>
  <button class="smallBtn" onclick="backToMain()">메인으로</button>
</div>

<!-- 뱃지 시뮬레이터 화면 -->
<div id="simulatorScreen">
  <h1>뱃지 시뮬레이터</h1>
  <label>
    <input type="checkbox" id="useRefine"> 연마제 사용 (최대 2개 옵션 잠금 가능)
  </label>
  <button class="btn" onclick="rollOptions()">옵션 굴리기</button>
  <div id="options"></div>
  <button class="btn" onclick="backToMain()">메인 화면으로</button>
</div>

<script>
function showSimulator(){
  document.getElementById("mainScreen").style.display = "none";
  document.getElementById("underConstruction").style.display = "none";
  document.getElementById("simulatorScreen").style.display = "block";
}
function showUnderConstruction(){
  document.getElementById("mainScreen").style.display = "none";
  document.getElementById("simulatorScreen").style.display = "none";
  document.getElementById("underConstruction").style.display = "flex";
}
function backToMain(){
  document.getElementById("simulatorScreen").style.display = "none";
  document.getElementById("underConstruction").style.display = "none";
  document.getElementById("mainScreen").style.display = "flex";
}
document.getElementById("leftImage").addEventListener("click", showSimulator);
document.getElementById("midImage").addEventListener("click", showUnderConstruction);
document.getElementById("rightImage").addEventListener("click", ()=>alert("준비중입니다."));

const groups = [
  {
    weight:30,
    options:[
      ["체력",[680,850,1020]],
      ["공격력",[70,88,105]],
      ["방어력",[35,44,53]],
      ["체력",["4%","5%","6%","12%"]],
      ["공격력",["4%","5%","6%","12%"]],
      ["방어력",["10%","12.5%","15%"]],
    ]
  },
  {
    weight:27.65,
    options:[
      ["일반 공격 치명타율",["5%","6.3%","7.5%"]],
      ["스킬 치명타율",["5%","6.3%","7.5%"]],
      ["필살기 치명타율",["5%","6.3%","7.5%"]],
      ["표식 치명타율",["5%","6.3%","7.5%"]],
      ["소환물 치명타율",["5%","6.3%","7.5%"]],
      ["파생물 치명타율",["5%","6.3%","7.5%"]],
    ]
  },
  {
    weight:34.35,
    options:[
      ["치명타 피해",["8%","10%","12%"]],
      ["속성 피해",["4%","5%","6%","12%"]],
      ["일반공격 피해",["10%","12.5%","15%","30%"]],
      ["스킬 피해",["7%","8%","10%","20%"]],
      ["필살기 피해",["10%","13%","15%","30%"]],
      ["표식 피해",["27%","33%","40%","80%"]],
      ["소환물 피해",["7%","8%","10%","20%"]],
      ["파생물 피해",["7%","8%","10%","20%"]],
    ]
  },
  {
    weight:8,
    options:[
      ["치명타율",["5%","6.3%","7.5%","15%"]],
      ["속성 관통",[35,40,53,110]],
      ["메인 SP",["10%","12.5%","15%","30%"]],
      ["지원 SP",["13.5","17","20.3","40%"]],
    ]
  }
];

const tierWeights = [35,30,20,15];
const colors = ["#66ff66","#33ccff","#ffdd33","linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet)"];
const lockedOptions = new Set();
const optionsDiv = document.getElementById("options");
const useRefine = document.getElementById("useRefine");
let optionValues = [];

function randomByWeight(weights){
  const total = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*total;
  for(let i=0;i<weights.length;i++){
    if(r<weights[i]) return i;
    r-=weights[i];
  }
  return weights.length-1;
}

function pickGroup(){
  const weights = groups.map(g=>g.weight);
  const total = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*total;
  for(let i=0;i<weights.length;i++){
    if(r<weights[i]) return groups[i];
    r -= weights[i];
  }
  return groups[groups.length-1];
}

function pickUniqueOptions(excludeNames){
  const result = [];
  const usedNames = new Set(excludeNames);

  while(result.length < 4 - excludeNames.length){
    const group = pickGroup();
    const candidates = group.options.filter(o => !usedNames.has(o[0]));
    if(candidates.length === 0) continue;
    const opt = candidates[Math.floor(Math.random()*candidates.length)];

    let tierIndex = randomByWeight(tierWeights);
    if(tierIndex >= opt[1].length) tierIndex = opt[1].length - 1;
    const val = opt[1][tierIndex];

    result.push({ name: opt[0], value: val, tier: tierIndex, maxTier: opt[1].length - 1 });
    usedNames.add(opt[0]);
  }
  return result;
}

function rollOptions(){
  const lockedNames = [];
  for(let i=0;i<4;i++){
    if(lockedOptions.has(i)) lockedNames.push(optionValues[i].name);
  }

  const newValues = pickUniqueOptions(lockedNames);
  let ni=0;
  for(let i=0;i<4;i++){
    if(lockedOptions.has(i)) continue;
    optionValues[i]=newValues[ni++];
  }
  renderOptions();
}

function toggleLock(i){
  if(!useRefine.checked) return;
  if(lockedOptions.has(i)){
    lockedOptions.delete(i);
  } else {
    if(lockedOptions.size>=2){ alert("최대 2개까지만 잠글 수 있습니다!"); return; }
    lockedOptions.add(i);
  }
  renderOptions();
}

function renderOptions(){
  optionsDiv.innerHTML="";
  for(let i=0;i<4;i++){
    const opt = optionValues[i];
    const div=document.createElement("div");
    div.textContent=`${opt.name} +${opt.value}`;
    div.className="option";
    if(lockedOptions.has(i)) div.classList.add("locked");

    // 색상 처리
    if(opt.tier === 3 && opt.maxTier >= 3){
      div.style.background = "linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet)";
      div.style.color = "#000";
    } else {
      const colorIndex = Math.min(opt.tier, 2);
      div.style.background = colors[colorIndex];
      div.style.color = "#000";
    }

    div.onclick = ()=>toggleLock(i);
    optionsDiv.appendChild(div);
  }
}

optionValues = pickUniqueOptions([]);
while(optionValues.length<4){
  const existingNames = optionValues.map(v=>v.name);
  const extra = pickUniqueOptions(existingNames)[0];
  optionValues.push(extra);
}
renderOptions();
</script>
</body>
</html>
